/**
 * Aircraft Sprite Markers
 *
 * Renders aircraft markers using pre-colored pw-silhouettes sprite sheets.
 *
 * Sprites: https://github.com/plane-watch/pw-silhouettes
 * License: CC BY-NC-SA 4.0
 *
 * Colored sprite sheets are generated at build time from the base white/black
 * sprite sheet using scripts/generate-colored-sprites.ts
 */

@use "../../styles/variables" as *;
@use "../../styles/mixins" as *;

.aircraft-sprite {
  // Button reset
  position: relative;
  padding: 0;
  border: none;
  background-color: transparent;
  outline: none;

  // Sprite background - default state (Mocha theme)
  // image-set() serves WebP to capable browsers (~25-35% smaller) and falls
  // back to PNG for older browsers.  Both files are generated at build time
  // by scripts/generate-colored-sprites.ts.
  background-image: image-set(
    url("../../assets/sprites/spritesheet-mocha-default.webp")
      type("image/webp"),
    url("../../assets/sprites/spritesheet-mocha-default.png") type("image/png")
  );
  background-repeat: no-repeat;
  /* background-size is set via inline style, computed from spritesheet.json metadata
     (sheetWidth * 0.6 x sheetHeight * 0.6) â€” see SpriteLoader.getCSSBackgroundSize() */
  width: 43.2px; /* 60% of 72px */
  height: 43.2px; /* 60% of 72px */
  cursor: pointer;
  transition:
    filter 0.15s ease,
    opacity 0.15s ease;
  transform-origin: center center;
  will-change: transform, filter;

  // Alert state - has alert conditions (red)
  &.has-alerts {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-mocha-alerts.webp")
        type("image/webp"),
      url("../../assets/sprites/spritesheet-mocha-alerts.png") type("image/png")
    );
    animation: pulse-alert 2s ease-in-out infinite;
  }

  // Low altitude state - below 500ft (gray)
  &.low-altitude {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-mocha-lowalt.webp")
        type("image/webp"),
      url("../../assets/sprites/spritesheet-mocha-lowalt.png") type("image/png")
    );
  }

  // Decoder-type colors (when colorByDecoder is enabled)
  &.decoder-acars {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-mocha-acars.webp")
        type("image/webp"),
      url("../../assets/sprites/spritesheet-mocha-acars.png") type("image/png")
    );
  }

  &.decoder-vdlm {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-mocha-vdlm.webp") type("image/webp"),
      url("../../assets/sprites/spritesheet-mocha-vdlm.png") type("image/png")
    );
  }

  &.decoder-hfdl {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-mocha-hfdl.webp") type("image/webp"),
      url("../../assets/sprites/spritesheet-mocha-hfdl.png") type("image/png")
    );
  }

  &.decoder-imsl {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-mocha-imsl.webp") type("image/webp"),
      url("../../assets/sprites/spritesheet-mocha-imsl.png") type("image/png")
    );
  }

  &.decoder-irdm {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-mocha-irdm.webp") type("image/webp"),
      url("../../assets/sprites/spritesheet-mocha-irdm.png") type("image/png")
    );
  }

  // Hover state - slight scale up
  // Note: Don't use transform here as it would override inline rotation
  &:hover {
    z-index: 1000;
    filter: brightness(1.1);
  }

  // Focus state for accessibility
  &:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 4px;
    z-index: 1001;
  }

  // Unread messages highlight - yellow/peach glow
  &.aircraft-marker--unread {
    filter: drop-shadow(0 0 5px rgba(250, 179, 135, 0.8));

    &:hover {
      filter: drop-shadow(0 0 7px rgba(250, 179, 135, 1));
    }
  }

  // Hovered state - pulsing blue glow
  &.aircraft-marker--hovered {
    z-index: 1000;
    filter: drop-shadow(0 0 12px var(--color-blue))
      drop-shadow(0 0 6px var(--color-blue));
    animation: marker-pulse 1.5s ease-in-out infinite;

    @media (prefers-reduced-motion: reduce) {
      filter: drop-shadow(0 0 12px var(--color-blue))
        drop-shadow(0 0 6px var(--color-blue));
      animation: none;
    }
  }

  // Followed aircraft - pulsing primary color glow
  &.aircraft-marker--followed {
    position: relative;
    filter: drop-shadow(0 0 8px var(--color-primary));

    // Pulsing ring animation
    &::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 150%;
      height: 150%;
      border: 3px solid var(--color-primary);
      border-radius: 50%;
      opacity: 0;
      animation: followed-pulse 2s ease-out infinite;
    }
  }
}

// Followed aircraft pulse animation
@keyframes followed-pulse {
  0% {
    opacity: 0.8;
    transform: translate(-50%, -50%) scale(0.8);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(1.5);
  }
}

// Hovered aircraft pulse animation
// Note: Don't use transform in animations as it would override inline rotation
@keyframes marker-pulse {
  0%,
  100% {
    filter: drop-shadow(0 0 12px var(--color-blue))
      drop-shadow(0 0 6px var(--color-blue));
    opacity: 1;
  }
  50% {
    filter: drop-shadow(0 0 20px var(--color-blue))
      drop-shadow(0 0 10px var(--color-blue))
      drop-shadow(0 0 4px var(--color-blue));
    opacity: 1;
  }
}

// Latte (light theme) overrides - use different colored sprite sheets
[data-theme="light"] .aircraft-sprite {
  // Default state - Latte
  background-image: image-set(
    url("../../assets/sprites/spritesheet-latte-default.webp")
      type("image/webp"),
    url("../../assets/sprites/spritesheet-latte-default.png") type("image/png")
  );

  // Alert state - Latte (red)
  &.has-alerts {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-latte-alerts.webp")
        type("image/webp"),
      url("../../assets/sprites/spritesheet-latte-alerts.png") type("image/png")
    );
  }

  // Low altitude state - Latte (gray)
  &.low-altitude {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-latte-lowalt.webp")
        type("image/webp"),
      url("../../assets/sprites/spritesheet-latte-lowalt.png") type("image/png")
    );
  }

  // Decoder-type colors (when colorByDecoder is enabled)
  &.decoder-acars {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-latte-acars.webp")
        type("image/webp"),
      url("../../assets/sprites/spritesheet-latte-acars.png") type("image/png")
    );
  }

  &.decoder-vdlm {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-latte-vdlm.webp") type("image/webp"),
      url("../../assets/sprites/spritesheet-latte-vdlm.png") type("image/png")
    );
  }

  &.decoder-hfdl {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-latte-hfdl.webp") type("image/webp"),
      url("../../assets/sprites/spritesheet-latte-hfdl.png") type("image/png")
    );
  }

  &.decoder-imsl {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-latte-imsl.webp") type("image/webp"),
      url("../../assets/sprites/spritesheet-latte-imsl.png") type("image/png")
    );
  }

  &.decoder-irdm {
    background-image: image-set(
      url("../../assets/sprites/spritesheet-latte-irdm.webp") type("image/webp"),
      url("../../assets/sprites/spritesheet-latte-irdm.png") type("image/png")
    );
  }
}

// Pulse animation for alerts
// Note: Don't use transform in animations as it would override inline rotation
@keyframes pulse-alert {
  0%,
  100% {
    filter: brightness(1);
    opacity: 1;
  }
  50% {
    filter: brightness(1.1);
    opacity: 0.95;
  }
}

// Animation frame cycling (for animated sprites like helicopters)
.aircraft-sprite--animated {
  // Animation will be handled by JavaScript frame cycling
  // This class is just a marker for animated sprites
}

// Sprite positioning is handled via inline styles:
// background-position: -${x}px -${y}px
// transform: rotate(${heading}deg)

// Accessibility: Pre-colored sprites with proper contrast
// Each state has its own sprite sheet with Catppuccin theme colors
// Black outlines preserved, fills properly colored
