#!/command/with-contenv bash
# shellcheck shell=bash

# Source ACARS common functions
# shellcheck disable=SC1091
# shellcheck source=/scripts/acars_common
source /scripts/acars_common

# create the /run/acars dir
mkdir -p /run/acars/

# Check for deprecated 'external' value and warn users
DEPRECATED_VARS_FOUND=false

if [[ ${ENABLE_ACARS,,} =~ external ]]; then
    echo " "
    echo "########################################################"
    echo "WARNING: ENABLE_ACARS='external' is deprecated!"
    echo "Please use ENABLE_ACARS=true or ENABLE_ACARS=false instead."
    echo "########################################################"
    echo " "

    DEPRECATED_VARS_FOUND=true
fi

if [[ ${ENABLE_VDLM,,} =~ external ]]; then
    echo " "
    echo "########################################################"
    echo "WARNING: ENABLE_VDLM='external' is deprecated!"
    echo "Please use ENABLE_VDLM=true or ENABLE_VDLM=false instead."
    echo "########################################################"
    echo " "

    DEPRECATED_VARS_FOUND=true
fi

if [[ ${ENABLE_HFDL,,} =~ external ]]; then
    echo " "
    echo "########################################################"
    echo "WARNING: ENABLE_HFDL='external' is deprecated!"
    echo "Please use ENABLE_HFDL=true or ENABLE_HFDL=false instead."
    echo "########################################################"
    echo " "

    DEPRECATED_VARS_FOUND=true
fi

if [[ ${ENABLE_IMSL,,} =~ external ]]; then
    echo " "
    echo "########################################################"
    echo "WARNING: ENABLE_IMSL='external' is deprecated!"
    echo "Please use ENABLE_IMSL=true or ENABLE_IMSL=false instead."
    echo "########################################################"
    echo " "
    DEPRECATED_VARS_FOUND=true
fi

if [[ ${ENABLE_IRDM,,} =~ external ]]; then
    echo " "
    echo "########################################################"
    echo "WARNING: ENABLE_IRDM='external' is deprecated!"
    echo "Please use ENABLE_IRDM=true or ENABLE_IRDM=false instead."
    echo "########################################################"
    echo " "
    DEPRECATED_VARS_FOUND=true
fi

if [[ "${DEPRECATED_VARS_FOUND}" == "true" ]]; then
    echo " "
    echo "########################################################"
    echo "The 'external' value will be removed in a future release."
    echo "Update your configuration to use 'true' or 'false'."
    echo "########################################################"
    echo " "
fi

# Ensure /database dir is present

mkdir -p /database/images/static/images

# Ensure stats files are present
touch /database/vdlm2.past5min.json
touch /database/acars.past5min.json

exit 0
